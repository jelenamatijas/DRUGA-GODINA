<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operator page</title>

    <style>
        .admin-header{
            margin-bottom: 100px;
            width: 100%;
            height: 60px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'DM Sans',sans-serif;
        }
        .admin-logo{
            margin-left: 42px;
            font-size: 20px;
            font-weight: bolder;
            line-height: 26px;
            letter-spacing: 0px;
            color: #229C9F;
        }
        .admin-name{
            font-size: 26px;
            font-weight: 400;
            line-height: 26px;
            color: #1E0E62;
            margin-left: auto;
            margin-right: auto;
            text-align: center;
        }
        .admin-header-img{
            margin-right: 42px;
            width: 42px;
            height: 42px;
            cursor: pointer;
        }
        .admin-container{
            margin-left: 88px;
            margin-right: 88px;
            margin-top: 60px;
            font-family: 'DM Sans',sans-serif;
            text-align: center;
        }

        .admin-wrapper{
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .admin-heading-wrapper{
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: baseline;
            
        }
        .admin-heading{
            margin-bottom: 100px;
            font-size: 42px;
            font-weight: bold;
            color: #1E0E62;
            line-height: 52px;
            letter-spacing: -0.4px;

        }

        .admin-box-wrapper{
            margin-top: 64px;
            display: flex;
        }

        .box{
            margin-left: 30px;
            margin-right: 30px;
            width:381.57px;
            height: 361.76px;
            border: 2px solid;
            border-color: #EBEAED;
            border-radius: 10px;;
        }
        .box-title{
            margin-left: auto;
            margin-right: auto;
            width:221.14px;
            height: 34.05;
            font-size: 22px;
            line-height: 32px;
            letter-spacing: 0px;
            font-weight:600;
            color: #1E0E62;
        }
        .box-description{
            margin-left: auto;
            margin-right: auto;
            margin-top:23px;
            width:283.89px;
            color:rgba(21, 20, 57, 0.4);
        }
        .admin-img{
            margin-top:60px;
            margin-bottom: 40px;
        }
        .operator-header{
            margin-bottom: 100px;
            width: 100%;
            height: 60px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'DM Sans',sans-serif;
        }
        .logo{
            margin-left: 42px;
            font-size: 20px;
            font-weight: bolder;
            line-height: 26px;
            letter-spacing: 0px;
            color: #229C9F;
        }
        .operator-heading{
            font-size: 26px;
            font-weight: 400;
            line-height: 26px;
            color: #1E0E62;
            margin-left: auto;
            margin-right: auto;
            text-align: center;
        }
        .operator-img{
            margin-right: 42px;
            width: 42px;
            height: 42px;
            cursor: pointer;
        }
        .op-show-tickets-container{
            font-family: 'DM Sans',sans-serif;
            margin-right: 147px;
            margin-left: 169px;
            margin-bottom: 60px;
            margin-top: 50px;
            text-align: left;
        }
        .op-show-tickets-guidance{
            margin-bottom: 38px;
            font-size: 20px;
            font-weight: bolder;
            line-height: 26px;
            letter-spacing: 0px;
            color: #229C9F;

        }
        .ticket-item-wrapper{
            display: flex;
            flex-direction: row;
        }
        .op-ticket-item{
            width: 100%;
            height: 60px;
            border: 1px solid #229C9F;
            color:#229C9F;
            border-radius: 100px;
            display: flex;
            flex-direction: row;
            align-items: center;
        }
        .op-ticket-item-wrapper{
            margin-bottom: 25px;
            display: flex;
            flex-direction: row;
        }
        .op-ticket-show-btn{
            margin-left: 32px;
            width: 180px;
            height: 60px;
            background-color: #229C9F;
            border:none;
            border-radius: 100px;
            color: white;
            transition: background-color 0.3s ease;
            cursor: pointer;
        }
        .op-ticket-name{
            margin-left: 42px;
        }
        .op-ticket-show-btn:hover{
            background-color: #175051;
        }
        .ticket-item{
            width: 100%;
            height: 60px;
            border: 1px solid #229C9F;
            color:#229C9F;
            border-radius: 100px;
            display: flex;
            flex-direction: row;
            align-items: center;
        }
        .ticket-show-btn{
            margin-left: 32px;
            width: 180px;
            height: 60px;
            background-color: #229C9F;
            border:none;
            border-radius: 100px;
            color: white;
            transition: background-color 0.3s ease;
            cursor: pointer;
        }
        .ticket-show-btn:hover{
            background-color: #175051;
        }
        .ticket-name{
            margin-left: 42px;
        }
    </style>

</head>
<body>
    <div class="operator-header">
        <div class="logo">GROUP 6</div>
        <div class="operator-heading" id="username">Operator</div>
        <img src="pngwing.png" class="operator-img" id="logoutButton" alt="Logout">
    </div>
    </div>
    <div class="op-show-tickets-container"><!--op ispred u klasama bice za operatera-->
        <div class="op-show-tickets-guidance">You have these tickets to process</div>
        <div class="op-ticket-list-wrapper" id="ticket-container">
        </div>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const userId = parseInt(params.get("id"),10);
        const userType = params.get("userType");
        const username = params.get("username");

        if(username){
            document.getElementById("username").textContent = username;
        }
        else{
            document.getElementById("username").textContent = "OPERATOR";
        }

        document.getElementById("logoutButton").addEventListener("click", function () {
            localStorage.clear(); 

            fetch("http://localhost:18080/logout", {
                method: "POST",
            }).then(() => {
                window.location.href = "http://localhost:18080/sign-in.html";
            }).catch(error => {
                console.error("Logout failed:", error);
                alert("An error occurred while logging out.");
            });
        });

        document.addEventListener("DOMContentLoaded", loadTickets);

        async function loadTickets() {
            const params = new URLSearchParams(window.location.search);
            const id = parseInt(params.get("id"),10);
            try {
                const response = await fetch("http://localhost:18080/operator-page", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        id: id,
                    })
                });
    
                if (!response.ok) {
                    throw new Error("Failed to fetch tickets");
                }
    
                const data = await response.json();
                const ticketContainer = document.getElementById("ticket-container");
    
                data.ticketIDs.forEach(ticketID => {
                    const ticketHTML = `
                        
                            <div class="ticket-item-wrapper">
                                <div class="ticket-item">
                                    <span class="ticket-name">Ticket ${ticketID}</span>
                                </div>
                                <button class="ticket-show-btn" onclick="redirectToTicket(${ticketID})">SHOW</button>
                            </div><br>
                       
                    `;
                    ticketContainer.innerHTML += ticketHTML;
                });
            } catch (error) {
                console.error("Error fetching tickets:", error);
                alert("Failed to load tickets.");
            }
        }
    
        // Funkcija za preusmeravanje na stranicu sa ID-jem tiketa
        function redirectToTicket(ticketID) {
            // Kreiranje URL-a sa ID-jem tiketa kao query parametar
            const tID = parseInt(ticketID, 10);
            const url = `http://localhost:18080/manage-ticket.html?ticketID=${tID}&username=${encodeURIComponent(username)}&id=${userId}&typeOfUser=${encodeURIComponent(userType)}`;
            window.location.href = url; // Preusmeravanje korisnika
        }
    </script>
</body>