import java.rmi.*;
import java.rmi.registry.*;
import java.rmi.server.*;
import java.io.*;
import java.util.Comparator;
import java.util.ArrayList;
import java.util.Arrays;

public class TelefonskiImenikServer extends UnicastRemoteObject implements TelefonskiImenik,Comparator<String>
{
  public File location = new File("teleImenik.txt");
  
  
  public TelefonskiImenikServer()throws RemoteException {} ;
  
  @Override
  public int compare(String a,String b)
  {
    int result = 0;
    
    if((a.split("#")[1]).compareTo(b.split("#")[1]) < 0) return -1;
    else if ((a.split("#")[1]).compareTo(b.split("#")[1]) > 0) return 1;
    else return 0;
    
  
  }
    
    
  
  public void pregledSadrzaja() throws RemoteException
  {
    try
    {
    if(location.exists())
    {
      BufferedReader br = new BufferedReader(new FileReader(location));
      
      String ispis = new String();
      
          System.out.println("SADRZAJ IMENIKA");
      
      while((ispis = br.readLine()) != null)
      {
    
        System.out.println(ispis);
      }
      
    }
    else
    {
      System.out.println("Dati folder ne postoji");
    }
    }
    catch(Exception ex)
    {
      ex.printStackTrace();
    }
    
  }
  
  
  public void pretrazivanjePoBrojuTelefona(String telefon) throws RemoteException
  {
    boolean mark = false;
    if(location.exists() )
    {
      try
      {
        
         BufferedReader br = new BufferedReader(new FileReader(location));
         
         String citac = new String();
         
         while((citac = br.readLine()) != null)
         {
           if(telefon.equalsIgnoreCase(citac.split("#")[3]))
           {
             if(telefon.startsWith("065"))
             {
               System.out.println("MOBILNI BROJ || " + "Ime: " + citac.split("#")[0] + " Prezime: " + citac.split("#")[1] + " Adresa: " + citac.split("#")[2] 
                                    + " Broj telefona: " + citac.split("#")[3]);
              
             }
             else
             {
                System.out.println("MOBILNI BROJ || " + "Ime: " + citac.split("#")[0] + " Prezime: " + citac.split("#")[1] + " Adresa: " + citac.split("#")[2] 
                                    + " Broj telefona: " + citac.split("#")[3]);
             }
               mark = true; 
           }
         }
         
         if (!mark) System.out.println("Dati broj nije pronadjen");
         br.close();
      }
      catch(Exception ex)
      {
        ex.printStackTrace();
      }
      
    }
    else
    {
      System.out.println("Dati fajl ne postoji");
    }
    
  }
  
  
  public void prikazSortiranPoPrezimenu()
  {
    ArrayList<String> lista = new ArrayList<String>();
    try(  BufferedReader br = new BufferedReader(new FileReader(location)); )
    {
     
      
      String s = new String();
      
      while((s=br.readLine()) != null)
      {
        lista.add(s);
      }
      
      String[] array = new String[lista.size()];
      
      for(int i=0;i<lista.size();i++) array[i] = lista.get(i);
      
      Arrays.sort(array,null);
      
      for(int i=0;i<lista.size();i++)
      {
        System.out.println(array[i]);
      }
        
      
    }
    catch(Exception ex)
    {
      ex.printStackTrace();
    }
    
    
  }
  
  
  public void dodavanjeUImenik(String podatak) throws RemoteException
  {
    
    try(PrintWriter pw = new PrintWriter(new BufferedWriter(new FileWriter(location,true)),true);)
    {
      pw.println(podatak);
    }
    catch(Exception ex)
    {
      ex.printStackTrace();
    }
  }
  
  public static void main(String[] args)
  {
    System.setSecurityManager(new RMISecurityManager());
    
    try
    {
      TelefonskiImenikServer tis = new TelefonskiImenikServer();
      
      Naming.rebind("//localhost:1099/server",tis);
      
      System.out.println("RMI server started....");
    }
    catch(Exception ex)
    {
      ex.printStackTrace();
    }
    
  }//zatvoren main
  
  
}//zatvorena klasa
    
    
    